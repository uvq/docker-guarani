version: '2'
services:

  web:
    build: .
    #image: siutoba/docker-guarani
    ports:
      - "127.0.0.1:3000:80"

    depends_on:
      - "pg"
    entrypoint: ["./wait-for-postgres.sh", "pg", "/entrypoint.d/entrypoint.sh"]
    command: ["apache2-foreground"]

    environment:
     TOBA_ID_DESARROLLADOR: XXX
     TOBA_PASS: toba
    
    volumes:
     - ~/devel-guarani/gestion:/var/local/gestion
     - ~/devel-guarani/docker-data/gestion/instalacion:/var/local/gestion/lib/toba/instalacion
     - ~/devel-guarani/autogestion:/var/local/autogestion
     - ~/devel-guarani/preinscripcion:/var/local/preinscripcion

    extra_hosts:
     - "scc-test.unq.edu.ar:192.168.0.130"
    networks:
     default:
      aliases:
       - webg3
  # Descomentar este bloque si se desea utilizar el servidor Jasper
  jasper:
    build: jasper/
    # image: siutoba/docker-guarani-jasper
    
    volumes:
     - ~/devel-guarani/gestion:/var/local/gestion
     - ~/devel-guarani/autogestion:/var/local/autogestion

  pg:
    image: postgres:9.4
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    volumes:
      - ~/devel-guarani/docker-data/pgdata:/var/lib/postgresql/data
    ports:
      - "127.0.0.1:5434:5432"
    command: "-c bytea_output=escape -c standard_conforming_strings=off"

  mailhog:
    image: mailhog/mailhog
    ports:
      - "127.0.0.1:8026:8026"
    environment:
      - MH_SMTP_BIND_ADDR=0.0.0.0:1025
      - MH_UI_BIND_ADDR=0.0.0.0:8026
      - MH_API_BIND_ADDR=0.0.0.0:8026

#hay que correr por unica vez
#docker network create uvq_net
networks:
  default:
    external:
      name: uvq_net
